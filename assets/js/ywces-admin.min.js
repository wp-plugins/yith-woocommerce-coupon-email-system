jQuery(function(e){e("body").on("click","button.ywces-send-test-email",function(){var s=e(this).prev().attr("value"),a=e(this).prev().attr("id").replace("ywces_test_",""),i=e("#ywces_mail_template").val()||"base",t="",n="",c="",l="",d="",o=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(o.test(s)){switch(a){case"purchases":case"spending":var _=e("#ywces_thresholds_"+a);if(0==_.find("tr.threshold").size())return void window.alert(ywces_admin.test_mail_no_threshold);_.find("tr.threshold").each(function(){var s=e(this).find(".ywces-threshold-coupon").val(),a=e(this).find(".ywces-threshold-amount").val();""!=s&&(t=s,n=a)});break;case"product_purchasing":case"birthday":case"last_purchase":if("product_purchasing"==a){if(c=e("#ywces_targets_product_purchasing").val(),""==c)return void window.alert(ywces_admin.test_mail_no_product)}else if("last_purchase"==a&&(d=e("#ywces_days_last_purchase").val(),""==d))return void window.alert(ywces_admin.test_mail_days_elapsed);var r=e("#ywces_coupon_"+a+"_settings");if(""==r.find(".ywces-coupon-amount").val())return void window.alert(ywces_admin.test_mail_no_amount);l={discount_type:r.find(".ywces-discount-type").val(),coupon_amount:r.find(".ywces-coupon-amount").val(),expiry_days:r.find(".ywces-expiry-days").val(),minimum_amount:r.find(".ywces-minimum-amount").val(),maximum_amount:r.find(".ywces-maximum-amount").val(),free_shipping:r.find(".ywces-free-shipping").is(":checked")?"yes":"",individual_use:r.find(".ywces-individual-use").is(":checked")?"yes":"",exclude_sale_items:r.find(".ywces-exclude-sale-items").is(":checked")?"yes":""};break;default:t=e("#ywces_coupon_"+a).val()}var u={action:"ywces_send_test_mail",email:s,type:a,coupon:t,threshold:n,template:i,products:c,coupon_info:l,days_elapsed:d};e.post(ywces_admin.ajax_url,u,function(e){window.alert(e===!0?ywces_admin.after_send_test_email:e.error)})}else window.alert(ywces_admin.test_mail_wrong)}),e(document).ready(function(e){var s=e(".ywces-collapse");s.each(function(){e(this).toggleClass("expand").nextUntil("tr.ywces-collapse").slideToggle(100)}),s.click(function(){e(this).toggleClass("expand").nextUntil("tr.ywces-collapse").slideToggle(100)}),e("#ywces_mail_template_enable").change(function(){e(this).is(":checked")?(e("#ywces_mail_template").val("base").prop("disabled",!0),e(".ywces-mailskin").hide()):(e("#ywces_mail_template").prop("disabled",!1),e(".ywces-mailskin").show())}).change()})});